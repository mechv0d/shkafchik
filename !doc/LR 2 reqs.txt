Интеграция React Query в существующий проект
Цель:
Изучить интеграцию React Query в существующий React проект, заменить useEffect запросы на useQuery и useMutation, настроить кэширование и оптимизировать производительность приложения.
Чек-лист выполнения:
1. Подготовка проекта:
• Установите React Query: npm install @tanstack/react-query
• Установите DevTools: npm install @tanstack/react-query-devtools
• Убедитесь, что у вас есть существующий React проект с API запросами
2. Настройка QueryClient:
• Создайте QueryClient с базовой конфигурацией
• Настройте QueryClientProvider в корне приложения
• Подключите React Query DevTools для development режима
• Настройте глобальные опции: staleTime, cacheTime, retry
3. Замена useEffect на useQuery:
• Найдите минимум 3 компонента с useEffect для получения данных
• Замените их на useQuery с правильными queryKey
• Настройте обработку состояний loading, error, success
• Проверьте, что кэширование работает корректно
4. Создание кастомных хуков:
• Создайте минимум 3 кастомных хука (например: useUsers, usePosts, useProfile)
• Вынесите API функции в отдельный модуль
• Организуйте структуру: api/ и hooks/ папки
• Переиспользуйте хуки в разных компонентах
5. Реализация мутаций:
• Создайте минимум 2 мутации (create, update или delete)
• Настройте обновление кэша после успешных мутаций
• Используйте invalidateQueries или setQueryData
• Добавьте обработку ошибок для мутаций
6. Оптимистичные обновления:
• Реализуйте оптимистичное обновление для одной мутации
• Настройте onMutate, onError, onSettled callbacks
• Проверьте rollback при ошибках
• Убедитесь в корректности UI во время выполнения
7. Продвинутые возможности:
• Настройте автоматическое обновление данных (refetchInterval)
• Реализуйте dependent queries (зависимые запросы)
• Добавьте prefetching для улучшения UX
• Настройте фильтрацию или поиск с помощью enabled опции
8. Тестирование и оптимизация:
• Используйте React Query DevTools для анализа запросов
• Проверьте Network tab - должно быть меньше дублирующихся запросов
• Настройте select для избежания лишних ре-рендеров
• Оптимизируйте queryKey для правильного кэширования
9. Обработка ошибок:
• Настройте глобальную обработку ошибок в QueryClient
• Реализуйте retry логику для неудачных запросов
• Добавьте fallback UI для ошибок
• Протестируйте поведение при отсутствии сети
10. Документация и отчет:
• Создайте README с описанием интеграции React Query
• Сравните 'до' и 'после' интеграции (код, производительность)
• Опишите настроенные query keys и их логику
• Добавьте скриншоты DevTools с активными запросами
11. Git и развертывание:
• Создайте отдельную ветку для интеграции React Query
• Делайте коммиты по шагам: setup, queries, mutations, optimization
• Убедитесь, что приложение корректно собирается и работает
• Проверьте bundle size до и после добавления React Query